/*!
 * @zevanoo/baileys-ez v1.0.0
 * Copyright (c) 2025 Zevano
 * Licensed under MIT
 */

import{jidNormalizedUser as y,getContentType as I,areJidsSameUser as M,getDevice as k}from"baileys";import{Func as b}from"../utils/func.js";const w=s=>{var a,r,n,d,m,p,f,g,l,u,o,c,x;const t={body:"",prefix:null,prefixes:[".","!","#","/"],command:null,arg:[],args:[],text:"",argsParsed:{}};t.body=((a=s.msg)==null?void 0:a.text)||((r=s.msg)==null?void 0:r.conversation)||((n=s.msg)==null?void 0:n.caption)||((d=s.message)==null?void 0:d.conversation)||((m=s.msg)==null?void 0:m.selectedButtonId)||((f=(p=s.msg)==null?void 0:p.singleSelectReply)==null?void 0:f.selectedRowId)||((g=s.msg)==null?void 0:g.selectedId)||((l=s.msg)==null?void 0:l.contentText)||((u=s.msg)==null?void 0:u.selectedDisplayText)||((o=s.msg)==null?void 0:o.title)||((c=s.msg)==null?void 0:c.name)||"",t.prefix=t.prefixes.find(h=>t.body.startsWith(h))||null;const i=(t.prefix?t.body.slice(t.prefix.length).trim():t.body.trim()).split(/ +/).filter(Boolean);return t.command=t.prefix&&((x=i.shift())==null?void 0:x.toLowerCase())||null,t.arg=t.body.trim().split(/ +/).filter(Boolean),t.text=i.join(" "),t.args=t.text.split(/ +/).filter(Boolean),t.argsParsed=b.parseArgs(t.text),t};async function T(s,t){var a,r,n,d,m,p,f,g,l,u;const e={};if(!t||!t.key||!t.message)return;e.raw=t,e.key=t.key,e.message=t.message,e.from=t.key.remoteJid||"",e.fromMe=t.key.fromMe===!0,e.id=t.key.id||"",e.device=k(e.id),e.isBaileys=e.id.startsWith("BAE5"),e.isGroup=e.from.endsWith("@g.us"),e.participant=e.isGroup?y(t.key.participantLid===void 0?t.key.participantPn:t.key.participant||""):null,e.sender=y(e.fromMe?(a=s==null?void 0:s.user)==null?void 0:a.id:e.isGroup?e.participant:e.from)||"",e.pushName=t.pushName||"",e.type=I(e.message),e.msg=e.type&&e.message?e.message[e.type]:null,e.msg&&typeof e.msg=="object"?(e.mentions=((r=e.msg.contextInfo)==null?void 0:r.mentionedJid)||[],e.expiration=((n=e.msg.contextInfo)==null?void 0:n.expiration)||0,e.isQuoted=!!((d=e.msg.contextInfo)!=null&&d.quotedMessage),e.isMedia=!!(e.msg.mimetype||e.msg.thumbnailDirectPath),e.isMedia&&(e.mimetype=e.msg.mimetype,e.size=e.msg.fileLength,e.height=e.msg.height,e.width=e.msg.width,e.isAnimated=(m=e.msg)==null?void 0:m.isAnimated)):(e.mentions=[],e.expiration=0,e.isQuoted=!1,e.isMedia=!1);const i=w(e);if(e.body=i.body,e.prefix=i.prefix,e.prefixes=i.prefixes,e.command=i.command,e.args=i.args,e.text=i.text,e.argsParsed=i.argsParsed,e.timestamp=typeof t.messageTimestamp=="number"?t.messageTimestamp:((p=t.messageTimestamp)==null?void 0:p.low)||0,e.quoted=null,e.isQuoted&&((g=(f=e.msg)==null?void 0:f.contextInfo)!=null&&g.quotedMessage)){const o={key:{remoteJid:e.from,fromMe:M(e.msg.contextInfo.participant||"",((u=(l=s.sock)==null?void 0:l.user)==null?void 0:u.id)||""),id:e.msg.contextInfo.stanzaId,participant:e.msg.contextInfo.participant},message:e.msg.contextInfo.quotedMessage};e.quoted=await T(s,o)||null}return e.reply=(o,c={})=>s.sendText(e.from,o,{quoted:e,...c}),e.download=o=>s.downloadMediaMessage(e,o),e.react=o=>s.react(e.from,e.key,o),e}export{T as serialize};

/*!
 * @zevanoo/baileys-ez v1.0.0
 * Copyright (c) 2025 Zevano
 * Licensed under MIT
 */

import{jidNormalizedUser as y,getContentType as M,areJidsSameUser as I,getDevice as w}from"baileys";import{Func as b}from"../utils/func.js";const k=s=>{var i,o,a,n,d,m,p,g,f,l,r,u,x;const t={body:"",prefix:null,prefixes:[".","!","#","/"],command:null,arg:[],args:[],text:"",argsParsed:{}};t.body=((i=s.msg)==null?void 0:i.text)||((o=s.msg)==null?void 0:o.conversation)||((a=s.msg)==null?void 0:a.caption)||((n=s.message)==null?void 0:n.conversation)||((d=s.msg)==null?void 0:d.selectedButtonId)||((p=(m=s.msg)==null?void 0:m.singleSelectReply)==null?void 0:p.selectedRowId)||((g=s.msg)==null?void 0:g.selectedId)||((f=s.msg)==null?void 0:f.contentText)||((l=s.msg)==null?void 0:l.selectedDisplayText)||((r=s.msg)==null?void 0:r.title)||((u=s.msg)==null?void 0:u.name)||"",t.prefix=t.prefixes.find(h=>t.body.startsWith(h))||null;const c=(t.prefix?t.body.slice(t.prefix.length).trim():t.body.trim()).split(/ +/).filter(Boolean);return t.command=t.prefix&&((x=c.shift())==null?void 0:x.toLowerCase())||null,t.arg=t.body.trim().split(/ +/).filter(Boolean),t.text=c.join(" "),t.args=t.text.split(/ +/).filter(Boolean),t.argsParsed=b.parseArgs(t.text),t};async function q(s,t){var a,n,d,m,p,g,f,l;const e={};if(!t||!t.key||!t.message)return;e.raw=t,e.key=t.key,e.message=t.message,e.from=t.key.remoteJid||"",e.fromMe=t.key.fromMe===!0,e.id=t.key.id||"",e.device=w(e.id),e.isBaileys=e.id.startsWith("BAE5"),e.isGroup=e.from.endsWith("@g.us");const c=t.key.addressingMode==="lid"?t.key.participantAlt:t.key.participant;e.participant=e.isGroup?y(c||""):null,e.sender=y((e.fromMe?(a=s.user)==null?void 0:a.id:e.isGroup?e.participant:e.from)||""),e.pushName=t.pushName||"",e.type=M(e.message),e.msg=e.type&&e.message?e.message[e.type]:null,e.msg&&typeof e.msg=="object"?(e.mentions=((n=e.msg.contextInfo)==null?void 0:n.mentionedJid)||[],e.expiration=((d=e.msg.contextInfo)==null?void 0:d.expiration)||0,e.isQuoted=!!((m=e.msg.contextInfo)!=null&&m.quotedMessage),e.isMedia=!!(e.msg.mimetype||e.msg.thumbnailDirectPath),e.isMedia&&(e.mimetype=e.msg.mimetype,e.size=e.msg.fileLength,e.height=e.msg.height,e.width=e.msg.width,e.isAnimated=(p=e.msg)==null?void 0:p.isAnimated)):(e.mentions=[],e.expiration=0,e.isQuoted=!1,e.isMedia=!1);const i=k(e);e.body=i.body,e.prefix=i.prefix,e.prefixes=i.prefixes,e.command=i.command,e.args=i.args,e.text=i.text,e.argsParsed=i.argsParsed;const o=t.messageTimestamp;if(e.timestamp=typeof o=="number"?o:(o==null?void 0:o.low)||0,e.quoted=null,e.isQuoted&&((f=(g=e.msg)==null?void 0:g.contextInfo)!=null&&f.quotedMessage)){const r={key:{remoteJid:e.from,fromMe:I(e.msg.contextInfo.participant||"",((l=s.user)==null?void 0:l.id)||""),id:e.msg.contextInfo.stanzaId,participant:e.msg.contextInfo.participant},message:e.msg.contextInfo.quotedMessage};e.quoted=await q(s,r)||null}return e.reply=(r,u)=>s.sendText(e.from,r,{quoted:e.raw,...u}),e.download=()=>s.downloadMediaMessage(e.raw),e.react=r=>s.react(e.from,e.key,r),e}export{q as serialize};
